<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.jmu.oscm.mapper.ResponsibilityIndicatorMapper">

    <resultMap id="mapper" type="edu.jmu.oscm.model.ResponsibilityIndicator">
        <result column="last_month_balance" property="lastMonthBalance"/>
        <result column="plan_month_target_value" property="planMonthTargetValue"/>
        <association property="item" column="ITEM_ID" select="edu.jmu.oscm.mapper.ItemMapper.getItemByItemId"/>
        <collection property="itemDepts" column="ITEM_ID" select="edu.jmu.oscm.mapper.ItemDeptMapper.selectItemDept"/>
        <collection property="itemEmployees" column="ITEM_ID" select="edu.jmu.oscm.mapper.ItemEmployeeMapper.selectItemEmployee"/>
    </resultMap>

    <select id="getResponsibilityIndicator" resultMap="mapper">
        SELECT last_month_balance,
        plan_month_target_value,
        a.ITEM_ID
        FROM report_item a
        LEFT JOIN ad_balance_target_value b
        ON a.ITEM_ID = b.ITEM_ID
        WHERE year=#{year} AND month=#{month} AND a.REPORT_ID=#{reportId}
    </select>

    <select id="getResponsibilityIndicatorByDeptCode" resultMap="mapper">
        SELECT last_month_balance,
        plan_month_target_value,
        a.ITEM_ID
        FROM report_item a
        LEFT JOIN ad_balance_target_value b
        ON a.ITEM_ID = b.ITEM_ID
        WHERE year=#{year} AND month=#{month} AND a.REPORT_ID=#{reportId} AND DEPT_CODE=#{deptCode}
    </select>

</mapper>