<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.jmu.oscm.mapper.ReportItemMapper">

    <resultMap id="ReportItemAndReportItemInstanceMapper" type="edu.jmu.oscm.model.ReportItem">
        <result property="itemId" column="ITEM_ID"/>
        <collection property="reportItemInstances" column="{reportItemId=ID,year=YEAR,month=MONTH}" select="edu.jmu.oscm.mapper.ReportItemInstanceMapper.getReportItemInstance"/>
    </resultMap>

    <resultMap id="ReportItemAndItemReduceTargetMapper" type="edu.jmu.oscm.model.ReportItem">
        <result property="itemId" column="ITEM_ID"/>
        <collection property="itemReduceTargets" column="{itemId=ITEM_ID,year=YEAR}" select="edu.jmu.oscm.mapper.ReportItemMapper.selectByItemIdAndYear"/>
    </resultMap>

    <resultMap id = "itemReduceTargetMapper" type="edu.jmu.oscm.model.ItemReduceTarget">
        <result column="ITEM_ID" property="itemId"/>
        <result column="DEPT_CODE" property="deptCode"/>
        <result column="last_year_value" property="lastYearValue"/>
        <result column="jan" property="jan"/>
        <result column="feb" property="feb"/>
        <result column="mar" property="mar"/>
        <result column="apr" property="apr"/>
        <result column="may" property="may"/>
        <result column="jun" property="jun"/>
        <result column="jul" property="jul"/>
        <result column="aug" property="aug"/>
        <result column="sept" property="sept"/>
        <result column="oct" property="oct"/>
        <result column="nov" property="nov"/>
        <result column="dec" property="dec"/>
    </resultMap>

    <select id="getReportItemAndReportItemInstance" resultMap="ReportItemAndReportItemInstanceMapper">
        SELECT ITEM_ID, ID,'${year}' YEAR, '${month}' MONTH
        FROM `report_item`
        WHERE REPORT_ID=#{reportId}
    </select>

    <select id="getReportItemAndItemReduceTarget" resultMap="ReportItemAndItemReduceTargetMapper">
        SELECT ITEM_ID,'${year}' YEAR
        FROM report_item
        WHERE REPORT_ID=#{reportId}
    </select>

    <select id="selectByItemIdAndYear" resultMap="itemReduceTargetMapper">
        SELECT DEPT_CODE,ITEM_ID, jan,feb,mar,apr,may,jun,jul,aug,sept,oct,nov,`dec`
        FROM ad_item_reduce_target
        WHERE ITEM_ID=#{itemId} AND `year`=#{year}
    </select>

</mapper>