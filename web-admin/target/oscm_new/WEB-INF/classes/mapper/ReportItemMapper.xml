<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.jmu.oscm.mapper.ReportItemMapper">

    <resultMap id="ReportItemAndReportItemInstanceMapper" type="edu.jmu.oscm.model.ReportItem">
        <id property="id" column="ID"/>
        <result property="state" column="year"/>
        <result property="modifyTime" column="MODIFY_TIME"/>
        <result property="itemId" column="ITEM_ID"/>
        <result property="orderNum" column="ORDER_NUM"/>
        <collection property="reportItemInstances" column="{reportItemId=ID,year=year,month=month}" select="edu.jmu.oscm.mapper.ReportItemInstanceMapper.getReportItemInstance"/>
    </resultMap>

    <resultMap id="ReportItemAndItemReduceTargetMapper" type="edu.jmu.oscm.model.ReportItem">
        <id property="id" column="ID"/>
        <result property="state" column="STATE"/>
        <result property="modifyTime" column="MODIFY_TIME"/>
        <result property="itemId" column="ITEM_ID"/>
        <result property="orderNum" column="ORDER_NUM"/>
        <association property="itemReduceTarget" javaType="edu.jmu.oscm.model.ItemReduceTarget">
            <result property="itemId" column="ITEM_ID"/>
            <result property="year" column="year"/>
            <result property="jun" column="jun"/>
            <result property="feb" column="feb"/>
            <result property="mar" column="mar"/>
            <result property="apr" column="apr"/>
            <result property="may" column="may"/>
            <result property="jan" column="jan"/>
            <result property="jul" column="jul"/>
            <result property="aug" column="aug"/>
            <result property="sept" column="sept"/>
            <result property="oct" column="oct"/>
            <result property="nov" column="nov"/>
            <result property="dec" column="dec"/>
        </association>
    </resultMap>

    <select id="getReportItemAndReportItemInstance" resultMap="ReportItemAndReportItemInstanceMapper">
        SELECT ID,REPORT_ID,ITEM_ID, '${year}' as year,'${month}' as month
        FROM report_item
        WHERE REPORT_ID = #{reportId}
    </select>

    <select id="getReportItemAndItemReduceTarget" resultMap="ReportItemAndItemReduceTargetMapper">
        SELECT a.ITEM_ID ITEM_ID,a.REPORT_ID REPORT_ID,year,jun,feb,mar,apr,may,jan,jul,aug,sept,oct,nov,`dec`
        FROM report_item a join ad_item_reduce_target b on a.ITEM_ID=b.ITEM_ID
        where year=#{year} and a.REPORT_ID=#{reportId}
    </select>

</mapper>